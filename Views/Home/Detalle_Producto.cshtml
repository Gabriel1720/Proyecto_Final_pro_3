@model Proyecto_final_pro_3.Models.Carrito

@{
    ViewData["Title"] = "second Page";

    if (ViewBag.userID != null)
    {
        Layout = "~/Views/Shared/_LayoutLogged.cshtml";

    }
}

<div class="container-fluid">
    <div class="row" style="margin-top: 5%;">

        <div class="d-inline-block" style="margin-left: 18%;">

            <img src="@ViewBag.Producto.Foto" style="width:200px; height:200px;">
        </div>

        <div class="d-inline-block col-12 col-md-6 mt-3 mt-md-0" style="padding-left: 4%;">

            <h2 class="">@ViewBag.Producto.Nombre</h2>
            <br />
            <p class="h5 font-weight-normal">@ViewBag.Producto.Descripcion</p>
            <br />
            <div class="" style="position:relative;">
                <p class="h5 d-inline-block"><strong>RD$ @ViewBag.Producto.Precio</strong></p>
                <form asp-controller="Home" method="post">
                    <strong>Cantidad: </strong>
                    <select name="Cantidad">
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                    </select>
                    <input type="number" value="@ViewBag.Producto.IdProducto" name="IdProducto" class="d-none" />
                    <br />
                    <button type="button" onclick="ShowMap()" class="btn border-0  mt-4 mb-5 px-4 py-2 d-inline-block " style="background: #FD5924; color: #fff;">Comprar ahora </button>
                    <button type="submit" asp-action="addCarrito" asp-controller="AdministrarCarrito" asp-area="Cliente" class="btn border-0  mt-4 mb-5 px-4  py-2  d-inline-block" style="background: #85E30C; color: #fff; margin-left: 7%;">Añadir al carrito</button>
                </form>
            </div>

        </div>
    </div>
</div>

<div class="padre d-flex align-items-center justify-content-center" style="height:170px;">
    <p class="display-4 text-center" style="color: #FF6F41;">Productos similares</p>
</div>

<div class="container mt-5 mb-5">
    <div class="owl-carousel">

        @foreach (Producto producto in ViewBag.Productos)
        {

            <div class="item" style="position: relative;">
                <div class="px-sm-4 pt-2" style="height: 350px;width:220px ;">
                    <div class="" style="height: 45%;">
                        <img src="@producto.Foto" class="img-fluid img-center" alt="">
                    </div>
                    <div class="text-center pt-sm-2" style="height: 30%;">
                        <p>@producto.Nombre</p>
                        <h4>@producto.Precio $</h4>
                        <br />
                    </div>
                    <div class="m-auto" style="height: 25%;">
                        <a class="btn btn-outline-oscuro btn-block btn-sm" asp-route-id="@producto.IdProducto" asp-controller="Home" asp-action="Detalle_Producto">Comprar ahora</a>
                    </div>
                </div>
            </div>

        }

        <input id="added" value="@ViewBag.Added" class="d-none" />
        <a asp-action="Comprar" asp-controller="Home"></a>
    </div>
</div>

  

<script>

    var added = document.getElementById("added").value;

    if (added == "success") {
        Swal.fire(
            'Perfecto!',
            'Se agrego el producto a su carrito!',
            'success'
        );
    }

    else if (added == "error") {
        Swal.fire(
            'Oop!',
            'Algo debio haber salido mal.',
            'error'
        );
    }

</script>


<script>
    function ShowMap() {

        Swal.fire({
            title: "<strong> Selecione su hubicacion </strong>",
            html:
                "<div id='mapid' style='width:80%; height:300px; margin:auto;'> </div>",
            showConfirmButton: true,
            showCancelButton: true,
            confirmButtonText : 'Continuar con la compra'
        }).then((result) => {
            if (result.value) {
                
            }

        })

        addMap(); 
    }


    function addMap() {
        // mostrar mapa leaftlet y optener coordenadas del usuario
        getLocation(); 

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.watchPosition(showPosition);
            } else {
                alert("Geolocation no es soportada por su navegador");
            }
        }

        function showPosition(position) {
            let latitud = position.coords.latitude;
            let longitud = position.coords.longitude;

            var map = L.map('mapid').setView([latitud, longitud], 14);


            L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
                attribution: '',
                maxZoom: 30,
                id: 'mapbox/streets-v11',
                tileSize: 512,
                zoomOffset: -1,
            }).addTo(map);


            var popup = L.popup();

            function onMapClick(e) {
                popup
                    .setLatLng(e.latlng)
                    .setContent("Su posicion es: " + e.latlng.toString())
                    .openOn(map);
            }

            map.on('click', onMapClick);
        }
 
    }

 
 
</script>